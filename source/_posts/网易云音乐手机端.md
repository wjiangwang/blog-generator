---
title: 网易云音乐手机端
date: 2018-08-22 19:02:25
tags:
---
## 环境搭建
*2018年8月22日：初步搭建LeanClound 和 七牛云环境，测试admin界面上传七牛云功能正常*

  在搭建过程中，使用的是七牛云1.x版本，由于七牛云设置需要`uptoken`，在本地利用七牛`Node.js` SDK 构建后端服务返回`uptoken`，所需要的 `accessKey secretKey`保留在本地，**切勿**上传至GitHub。
共引用如下库
```js
    <script src="../node_modules/leancloud-storage/dist/av-min.js"></script>
    <script src="../node_modules/qiniu-js/dist/qiniu.min.js"></script>
    <script src="../node_modules/plupload/js/moxie.js"></script>
    <script src="../node_modules/plupload/js/plupload.dev.js"></script>
```
服务端代码
```js
    response.statusCode = 200;
    response.setHeader("Content-Type", "text/json; charset=utf-8");
    response.setHeader("Access-Control-Allow-Origin", "*");
    
    var config = fs.readFileSync("xxx.json");//存有"accessKey""secretKey"的json文件
    config=JSON.parse(config)
    let{accessKey,secretKey}=config
    var mac = new qiniu.auth.digest.Mac(accessKey, secretKey);

    var options = {
        scope: 'bucket',//项目名称
      };
      var putPolicy = new qiniu.rs.PutPolicy(options);
      var uploadToken=putPolicy.uploadToken(mac);
    
    response.write(`
    {
        "uptoken":"${uploadToken}"
    }`);
    response.end();
```
并在[七牛云配置](https://github.com/qiniu/js-sdk/tree/1.x) 中设置相应的路径`uptoken_url`，同时开启server服务器和自己的页面进行测试。
